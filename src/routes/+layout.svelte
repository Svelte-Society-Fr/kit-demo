<script lang="ts">
  import { onNavigate } from '$app/navigation';
  import { page } from '$app/stores';

  const links = [
    {
      label: 'Accueil',
      href: '/',
    },
    {
      label: 'Pokedex',
      href: '/pokedex',
    },
    {
      label: 'Info',
      href: '/faq',
    },
    {
      label: 'Sac',
      href: '/bag',
    },
  ];

  export let data;

  $: ({ bag } = data);

  onNavigate(navigation => {
    if (!document.startViewTransition) return;

    return new Promise(resolve => {
      document.startViewTransition(async () => {
        resolve();

        await navigation.complete;
      });
    });
  });
</script>

<header>
  <nav>
    {#each links as { href, label: originalLabel }}
      {@const current = $page.url.pathname === href}
      {@const label =
        href === '/bag' && bag.length
          ? `${originalLabel}(${bag.length})`
          : originalLabel}
      <a {href} aria-current={current ? 'page' : null}>{label}</a>
    {/each}
  </nav>
</header>

<main>
  <slot />
</main>

<style>
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    height: 4rem;
  }

  nav {
    display: flex;
    gap: 1rem;
  }

  main {
    position: relative;
    display: flex;
    flex-direction: column;
    overflow: auto;
    flex: 1;
    flex-wrap: wrap;
    align-content: center;
    justify-content: center;
    padding: 1rem;
  }

  a {
    position: relative;
  }

  [aria-current='page'] {
    color: #333;
  }

  [aria-current='page']::before {
    --size: 6px;
    content: '';
    width: 0;
    height: 0;
    display: block;
    position: absolute;
    top: -6px;
    left: calc(50% - var(--size));
    border: var(--size) solid transparent;
    border-top: var(--size) solid black;
    view-transition-name: active-page;
  }
</style>
